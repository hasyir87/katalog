/**
 * @fileoverview Firestore Security Rules for ScentVault.
 *
 * Core Philosophy:
 * This ruleset provides public read access to scent categories (jenisAromas) and restricts write access to perfume data (perfumes) to authenticated users.
 *
 * Data Structure:
 * - /jenisAromas/{jenisAromaId}: Stores publicly readable scent categories.
 * - /perfumes/{perfumeId}: Stores perfume data entries, write-protected to authenticated users.
 *
 * Key Security Decisions:
 * - Public read access to scent categories allows for a public catalog view.
 * - Write access to perfume data is limited to authenticated users, preventing unauthorized modifications.
 * - No listing restrictions are applied to authenticated users.
 *
 * Denormalization for Authorization:
 * - No denormalization needed: Authorization for perfumes is handled implicitly through authentication.
 *
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access to scent categories.
     * @path /jenisAromas/{jenisAromaId}
     * @allow (get, list) Any user can read scent categories.
     * @deny (create, update, delete) No one can create, update, or delete scent categories through Firestore.
     * @principle Public read access for catalog data.
     */
    match /jenisAromas/{jenisAromaId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Restricts write access to perfume data to authenticated users.
     * @path /perfumes/{perfumeId}
     * @allow (create, update, delete) Authenticated users can create, update, and delete perfume entries.
     * @allow (get, list) Any user can read perfume entries.
     * @deny (create, update, delete) Unauthenticated users cannot modify perfume data.
     * @principle Authenticated users manage perfume data.
     */
    match /perfumes/{perfumeId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource.data.id == request.resource.data.id;
      allow delete: if isSignedIn() && exists(resource);
    }

    // Helper function to check if the current user is signed in.
    function isSignedIn() {
      return request.auth != null;
    }

        // Helper function to check if a resource exists
    function exists(resource) {
      return resource != null;
    }
  }
}